graph TD;
    A["Cloud Scheduler (5-min)"] --> B["check_games_handler()"]
    B --> C["check_active_players()"]
    C --> D["fetch_game_status()"]
    D --> E["Game Concluded?"]
    E -- "Yes" --> F["update_doc() with gameStatus:Concluded"]
    F --> G["move_player_to_concluded()"]
    G --> H["Firestore Trigger: onPlayerStatusChange"]
    H --> I["Copy to concluded/ + Delete from active/"]
    I --> J["update_bet_pick_references()"]
    J --> K["check_active_bets()"]
    K --> L["All picks concluded?"]
    L -- "Yes" --> M["Set bet status to Won/Lost"]
    M --> N["Firestore Trigger: onActiveBetWrite"]
    N --> O["Archive bet to betHistory/"]